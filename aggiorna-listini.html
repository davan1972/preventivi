<!DOCTYPE html>
<html lang="it">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Aggiorna Listini Montascale</title>
    <style>
    :root {
    --primary: #1e40af;
    --primary-light: #3b82f6;
    --primary-lighter: #60a5fa;
    --accent: #0ea5e9;
    --accent-light: #38bdf8;
    --bg: #f0f9ff;
    --surface: #ffffff;
    --text: #1e293b;
    --text-light: #64748b;
    --border: #e0e7ff;
}

* { margin: 0; padding: 0; box-sizing: border-box; }

body {
    font-family: 'Outfit', sans-serif;
    background: linear-gradient(135deg, #e0f2fe 0%, #dbeafe 50%, #e0e7ff 100%);
    color: var(--text);
    line-height: 1.6;
    min-height: 100vh;
}

.container { 
    max-width: 1000px; 
    margin: 0 auto; 
    padding: 40px 20px; 
}

header { 
    text-align: center; 
    margin-bottom: 60px; 
    padding-top: 30px; 
}

.logo {
    width: 40px;
    height: 40px;
    margin: 0 auto 25px;
    display: block;
    filter: drop-shadow(0 6px 16px rgba(14,165,233,0.25));
    animation: logoFloat 4s ease-in-out infinite;
}

@keyframes logoFloat {
    0%, 100% { transform: translateY(0px) rotate(0deg); }
    50% { transform: translateY(-12px) rotate(2deg); }
}

h1 {
    font-family: 'DM Serif Display', serif;
    font-size: 3.8rem;
    background: linear-gradient(135deg, #0ea5e9 0%, #3b82f6 50%, #6366f1 100%);
    -webkit-background-clip: text;
    -webkit-text-fill-color: transparent;
    background-clip: text;
    margin-bottom: 15px;
    letter-spacing: -0.03em;
    font-weight: 400;
}

.subtitle { 
    font-size: 1.2rem; 
    color: var(--text-light); 
    font-weight: 400;
}

.decorative-line {
    width: 120px;
    height: 4px;
    background: linear-gradient(90deg, transparent, #0ea5e9, #3b82f6, transparent);
    margin: 35px auto;
    border-radius: 4px;
    box-shadow: 0 3px 10px rgba(14,165,233,0.3);
}

.form-card {
    background: rgba(255,255,255,0.95);
    backdrop-filter: blur(10px);
    border-radius: 32px;
    padding: 55px;
    box-shadow: 0 20px 60px rgba(30,64,175,0.15), 0 0 0 1px rgba(255,255,255,0.5);
    border: 1px solid rgba(255,255,255,0.8);
    margin-bottom: 30px;
    position: relative;
    overflow: hidden;
}

.form-card::before {
    content: '';
    position: absolute;
    top: 0;
    left: 0;
    right: 0;
    height: 5px;
    background: linear-gradient(90deg, #0ea5e9, #3b82f6, #6366f1);
}

.form-section {
    margin-bottom: 55px;
    opacity: 0;
    animation: fadeInUp 0.7s ease forwards;
}

.form-section:nth-child(1) { animation-delay: 0.1s; }
.form-section:nth-child(2) { animation-delay: 0.2s; }
.form-section:nth-child(3) { animation-delay: 0.3s; }
.form-section:nth-child(4) { animation-delay: 0.4s; }
.form-section:nth-child(5) { animation-delay: 0.5s; }

@keyframes fadeInUp {
    from { opacity: 0; transform: translateY(25px); }
    to { opacity: 1; transform: translateY(0); }
}

.section-title {
    font-family: 'DM Serif Display', serif;
    font-size: 1.9rem;
    color: var(--primary);
    margin-bottom: 28px;
    display: flex;
    align-items: center;
    gap: 18px;
}

.section-number {
    background: linear-gradient(135deg, #0ea5e9, #3b82f6);
    color: white;
    width: 42px;
    height: 42px;
    border-radius: 14px;
    display: flex;
    align-items: center;
    justify-content: center;
    font-size: 1.1rem;
    font-weight: 700;
    box-shadow: 0 4px 12px rgba(59,130,246,0.35);
}

.radio-group {
    display: grid;
    grid-template-columns: repeat(auto-fit, minmax(240px, 1fr));
    gap: 18px;
    margin-top: 18px;
}

.radio-option { position: relative; }
.radio-option input[type="radio"] { position: absolute; opacity: 0; }

.radio-option label {
    display: block;
    padding: 22px 26px;
    background: linear-gradient(135deg, #f0f9ff 0%, #e0f2fe 100%);
    border: 2px solid #bae6fd;
    border-radius: 16px;
    cursor: pointer;
    transition: all 0.4s cubic-bezier(0.4,0,0.2,1);
    font-weight: 500;
    font-size: 1rem;
}

.radio-option input[type="radio"]:checked + label {
    background: linear-gradient(135deg, #0ea5e9, #3b82f6);
    color: white;
    border-color: transparent;
    transform: translateY(-4px) scale(1.02);
    box-shadow: 0 12px 28px rgba(59,130,246,0.4);
}

.radio-option label:hover {
    border-color: var(--primary-light);
    box-shadow: 0 6px 20px rgba(59,130,246,0.2);
    transform: translateY(-2px);
}

.checkbox-option {
    margin-bottom: 16px;
    display: block;
}

.checkbox-option input[type="checkbox"] { display: none; }

.checkbox-option label {
    display: flex;
    align-items: center;
    gap: 16px;
    padding: 18px 22px;
    background: linear-gradient(135deg, #f0f9ff 0%, #e0f2fe 100%);
    border: 2px solid #bae6fd;
    border-radius: 14px;
    cursor: pointer;
    transition: all 0.3s ease;
    font-size: 0.98rem;
}

.checkbox-option input[type="checkbox"]:checked + label {
    background: linear-gradient(135deg, #3b82f6, #60a5fa);
    color: white;
    border-color: transparent;
    box-shadow: 0 4px 16px rgba(59,130,246,0.3);
}

.checkbox-option label:hover {
    border-color: var(--primary-light);
    transform: translateX(6px);
    box-shadow: 0 2px 12px rgba(59,130,246,0.15);
}

.checkbox-icon {
    width: 24px;
    height: 24px;
    border: 2px solid currentColor;
    border-radius: 8px;
    display: flex;
    align-items: center;
    justify-content: center;
    flex-shrink: 0;
    transition: all 0.3s ease;
}

.checkbox-option input[type="checkbox"]:checked + label .checkbox-icon {
    background: white;
    border-color: white;
}

.checkbox-option input[type="checkbox"]:checked + label .checkbox-icon::after {
    content: 'âœ“';
    color: var(--primary);
    font-weight: bold;
    font-size: 15px;
}

.input-wrapper { margin-bottom: 24px; }

.input-wrapper label {
    display: block;
    margin-bottom: 11px;
    font-weight: 600;
    color: var(--text);
    font-size: 0.98rem;
}

.input-wrapper input,
.input-wrapper textarea {
    width: 100%;
    padding: 18px 22px;
    border: 2px solid #bae6fd;
    border-radius: 14px;
    font-family: 'Outfit', sans-serif;
    font-size: 1rem;
    transition: all 0.3s cubic-bezier(0.4,0,0.2,1);
    background: white;
}

.input-wrapper input:focus,
.input-wrapper textarea:focus {
    outline: none;
    border-color: var(--primary-light);
    box-shadow: 0 0 0 5px rgba(59,130,246,0.12);
    transform: translateY(-2px);
}

.input-wrapper textarea { 
    resize: vertical; 
    min-height: 120px; 
}

.input-hint { 
    font-size: 0.88rem; 
    color: var(--text-light); 
    margin-top: 9px; 
}

.option-category {
    margin-bottom: 38px;
    padding: 30px;
    background: linear-gradient(135deg, #f0f9ff 0%, #e0f2fe 100%);
    border-radius: 18px;
    border: 1px solid #bae6fd;
}

.category-title {
    font-family: 'DM Serif Display', serif;
    font-size: 1.35rem;
    color: var(--primary);
    margin-bottom: 22px;
    padding-bottom: 14px;
    border-bottom: 3px solid var(--accent);
}

.price-summary {
    background: linear-gradient(135deg, rgba(240,249,255,0.95) 0%, rgba(224,242,254,0.95) 100%);
    backdrop-filter: blur(10px);
    border: 3px solid #0ea5e9;
    border-radius: 24px;
    padding: 45px;
    margin-top: 22px;
    box-shadow: 0 12px 40px rgba(30,64,175,0.18);
}

.price-row {
    display: flex;
    justify-content: space-between;
    align-items: center;
    padding: 22px 0;
    border-bottom: 2px solid #bae6fd;
}

.price-row:last-child { border-bottom: none; }

.price-block {
    display: flex;
    flex-direction: column;
    align-items: flex-end;
    gap: 7px;
}

.price-label {
    font-size: 1.4rem;
    font-weight: 600;
    color: var(--text);
}

.price-value {
    font-family: 'DM Serif Display', serif;
    font-size: 2.4rem;
    font-weight: bold;
    background: linear-gradient(135deg, #0ea5e9, #3b82f6);
    -webkit-background-clip: text;
    -webkit-text-fill-color: transparent;
    background-clip: text;
}

.price-iva { 
    font-size: 0.98rem; 
    color: var(--text-light); 
}

.price-final {
    margin-top: 18px;
    padding-top: 32px;
    border-top: 3px solid var(--accent) !important;
}

.price-final .price-label {
    font-size: 1.7rem;
    font-weight: 700;
    color: var(--primary);
}

.price-final .price-value { 
    font-size: 3.2rem; 
}

.discount-input-wrapper {
    margin: 32px 0;
    padding: 32px;
    background: white;
    border-radius: 18px;
    border: 3px solid #38bdf8;
    box-shadow: 0 6px 24px rgba(59,130,246,0.15);
}

.discount-input-wrapper label {
    display: block;
    font-size: 1.3rem;
    font-weight: 700;
    color: var(--primary);
    margin-bottom: 16px;
}

.discount-input-wrapper input {
    width: 100%;
    padding: 22px 30px;
    font-size: 2.2rem;
    font-weight: 700;
    text-align: center;
    border: 3px solid #bae6fd;
    border-radius: 16px;
    font-family: 'Outfit', sans-serif;
    background: linear-gradient(135deg, #f0f9ff, #e0f2fe);
    color: var(--primary);
    transition: all 0.3s cubic-bezier(0.4,0,0.2,1);
}

.discount-input-wrapper input:focus {
    outline: none;
    border-color: var(--accent);
    box-shadow: 0 0 0 6px rgba(14,165,233,0.18);
    background: white;
    transform: scale(1.02);
}

.btn-submit {
    background: linear-gradient(135deg, #0ea5e9, #3b82f6, #6366f1);
    color: white;
    padding: 22px 55px;
    border: none;
    border-radius: 16px;
    font-size: 1.2rem;
    font-weight: 700;
    cursor: pointer;
    transition: all 0.4s cubic-bezier(0.4,0,0.2,1);
    font-family: 'Outfit', sans-serif;
    width: 100%;
    margin-top: 28px;
    box-shadow: 0 12px 32px rgba(59,130,246,0.35);
    letter-spacing: 0.03em;
    position: relative;
    overflow: hidden;
}

.btn-submit::before {
    content: '';
    position: absolute;
    top: 0;
    left: -100%;
    width: 100%;
    height: 100%;
    background: linear-gradient(90deg, transparent, rgba(255,255,255,0.3), transparent);
    transition: left 0.5s;
}

.btn-submit:hover::before {
    left: 100%;
}

.btn-submit:hover {
    transform: translateY(-4px);
    box-shadow: 0 16px 40px rgba(59,130,246,0.45);
}

.btn-submit:active {
    transform: translateY(-1px);
}

#risultato {
    margin-top: 45px;
    padding: 40px;
    background: linear-gradient(135deg, #0ea5e9, #3b82f6);
    color: white;
    border-radius: 24px;
    display: none;
    box-shadow: 0 20px 60px rgba(59,130,246,0.4);
}

#risultato h2 {
    font-family: 'DM Serif Display', serif;
    font-size: 2.4rem;
    margin-bottom: 22px;
}

.loading {
    text-align: center;
    padding: 55px;
}

.spinner {
    border: 5px solid rgba(255,255,255,0.2);
    border-top: 5px solid #0ea5e9;
    border-radius: 50%;
    width: 65px;
    height: 65px;
    animation: spin 1s linear infinite;
    margin: 0 auto 28px;
}

@keyframes spin {
    0% { transform: rotate(0deg); }
    100% { transform: rotate(360deg); }
}

.hidden { display: none; }

footer {
    text-align: center;
    margin-top: 85px;
    padding-top: 55px;
    border-top: 2px solid rgba(59,130,246,0.2);
    color: var(--text-light);
    font-size: 0.92rem;
}

@media (max-width: 768px) {
    h1 { font-size: 2.8rem; }
    .logo { width: 35px; height: 35px; }
    .form-card { padding: 35px 22px; }
    .radio-group { grid-template-columns: 1fr; }
    .price-summary { padding: 30px; }
    .price-value { font-size: 2rem; }
    .price-final .price-value { font-size: 2.6rem; }
}

    </style>
</head>
<body>
    <div class="container">
        <h1>ðŸ”„ Aggiorna Listini</h1>
        <p class="subtitle">Carica i file Excel aggiornati</p>

        <label class="file-label">File Poltroncine (.xlsx)</label>
        <div class="upload-area" id="uploadPoltroncine" onclick="document.getElementById('filePoltroncine').click()">
            <div class="upload-icon">ðŸ“Š</div>
            <p>Clicca o trascina il file qui</p>
            <small>LISTINI_2026_FACILE_SALIRE_-_MS_POLTRONCINE.xlsx</small>
        </div>
        <input type="file" id="filePoltroncine" accept=".xlsx">
        <div class="file-info" id="infoPoltroncine"></div>

        <label class="file-label" style="margin-top: 30px;">File Pedane (.xlsx)</label>
        <div class="upload-area" id="uploadPedane" onclick="document.getElementById('filePedane').click()">
            <div class="upload-icon">ðŸ“Š</div>
            <p>Clicca o trascina il file qui</p>
            <small>LISTINI_2026_FACILE_SALIRE_-_MS_PEDANE.xlsx</small>
        </div>
        <input type="file" id="filePedane" accept=".xlsx">
        <div class="file-info" id="infoPedane"></div>

        <button class="btn" id="btnElabora" disabled>Elabora e Aggiorna HTML</button>

        <div class="progress" id="progress">
            <div class="progress-bar">
                <div class="progress-fill" id="progressFill"></div>
            </div>
            <ul class="step-list" id="stepList"></ul>
        </div>

        <div class="result" id="result"></div>
    </div>

    <script src="https://cdnjs.cloudflare.com/ajax/libs/xlsx/0.18.5/xlsx.full.min.js"></script>
    <script>
        let filePoltroncine = null;
        let filePedane = null;

        // Gestione upload Poltroncine
        document.getElementById('filePoltroncine').addEventListener('change', function(e) {
            filePoltroncine = e.target.files[0];
            if (filePoltroncine) {
                document.getElementById('infoPoltroncine').innerHTML = `âœ“ ${filePoltroncine.name} (${(filePoltroncine.size / 1024).toFixed(1)} KB)`;
                document.getElementById('infoPoltroncine').classList.add('show');
            }
            checkFiles();
        });

        // Gestione upload Pedane
        document.getElementById('filePedane').addEventListener('change', function(e) {
            filePedane = e.target.files[0];
            if (filePedane) {
                document.getElementById('infoPedane').innerHTML = `âœ“ ${filePedane.name} (${(filePedane.size / 1024).toFixed(1)} KB)`;
                document.getElementById('infoPedane').classList.add('show');
            }
            checkFiles();
        });

        // Drag & drop
        ['uploadPoltroncine', 'uploadPedane'].forEach(id => {
            const area = document.getElementById(id);
            const fileInput = id === 'uploadPoltroncine' ? 'filePoltroncine' : 'filePedane';

            area.addEventListener('dragover', (e) => {
                e.preventDefault();
                area.classList.add('dragover');
            });

            area.addEventListener('dragleave', () => {
                area.classList.remove('dragover');
            });

            area.addEventListener('drop', (e) => {
                e.preventDefault();
                area.classList.remove('dragover');
                const files = e.dataTransfer.files;
                if (files.length > 0) {
                    document.getElementById(fileInput).files = files;
                    document.getElementById(fileInput).dispatchEvent(new Event('change'));
                }
            });
        });

        function checkFiles() {
            document.getElementById('btnElabora').disabled = !(filePoltroncine && filePedane);
        }

        // Elabora file
        document.getElementById('btnElabora').addEventListener('click', async function() {
            const btn = this;
            btn.disabled = true;
            const progress = document.getElementById('progress');
            const result = document.getElementById('result');
            const stepList = document.getElementById('stepList');
            const progressFill = document.getElementById('progressFill');

            progress.classList.add('show');
            result.classList.remove('show');
            stepList.innerHTML = '';

            try {
                // Funzione per aggiungere step
                const addStep = (text, done = false) => {
                    const li = document.createElement('li');
                    li.textContent = text;
                    if (done) li.classList.add('done');
                    stepList.appendChild(li);
                    return li;
                };

                // Step 1: Lettura file
                addStep('Lettura file Excel...', false);
                progressFill.style.width = '20%';

                const modelliPrezzi = {};

                // Leggi Poltroncine
                const dataPoltroncine = await filePoltroncine.arrayBuffer();
                const wbPoltroncine = XLSX.read(dataPoltroncine);
                wbPoltroncine.SheetNames.forEach(sheetName => {
                    const ws = wbPoltroncine.Sheets[sheetName];
                    const data = XLSX.utils.sheet_to_json(ws, { header: 1 });
                    modelliPrezzi[sheetName] = estraiPrezzi(data);
                });

                stepList.lastChild.classList.add('done');
                addStep('Lettura file Pedane...', false);
                progressFill.style.width = '40%';

                // Leggi Pedane
                const dataPedane = await filePedane.arrayBuffer();
                const wbPedane = XLSX.read(dataPedane);
                wbPedane.SheetNames.forEach(sheetName => {
                    const ws = wbPedane.Sheets[sheetName];
                    const data = XLSX.utils.sheet_to_json(ws, { header: 1 });
                    modelliPrezzi[sheetName] = estraiPrezzi(data);
                });

                stepList.lastChild.classList.add('done');
                addStep('Generazione codice JavaScript...', true);
                progressFill.style.width = '60%';

                // Genera JavaScript
                const jsCode = `const prezziModelli = ${JSON.stringify(modelliPrezzi, null, 12)};`;

                addStep('Download HTML aggiornato...', true);
                progressFill.style.width = '80%';

                // Scarica HTML (simulato - in realtÃ  mostreremo il codice)
                const blob = new Blob([jsCode], { type: 'text/javascript' });
                const url = URL.createObjectURL(blob);
                const a = document.createElement('a');
                a.href = url;
                a.download = 'prezzi_aggiornati.js';
                a.click();

                progressFill.style.width = '100%';
                addStep('Completato!', true);

                setTimeout(() => {
                    result.className = 'result success show';
                    result.innerHTML = `
                        <h3>âœ… Elaborazione completata!</h3>
                        <p style="margin-top: 10px;">File "prezzi_aggiornati.js" scaricato.</p>
                        <p style="margin-top: 10px; font-size: 0.9rem;">
                            <strong>Prossimi passi:</strong><br>
                            1. Apri preventivi-montascale-v2.html<br>
                            2. Cerca la sezione "const prezziModelli"<br>
                            3. Sostituisci con il contenuto di prezzi_aggiornati.js<br>
                            4. Salva e carica su GitHub
                        </p>
                    `;
                    btn.disabled = false;
                }, 500);

            } catch (error) {
                result.className = 'result error show';
                result.innerHTML = `<h3>âš  Errore</h3><p>${error.message}</p>`;
                btn.disabled = false;
            }
        });

        // Funzione estrazione prezzi (semplificata)
        function estraiPrezzi(data) {
            const prezzi = {};
            
            // Prezzo base (riga 6, colonna D = index 3)
            if (data[5] && data[5][3]) {
                prezzi.base = parseFloat(data[5][3]) || 0;
            }

            // Scansiona righe per opzioni
            for (let i = 6; i < Math.min(data.length, 60); i++) {
                const row = data[i];
                if (!row) continue;

                const desc = row[1]; // Colonna B
                const prezzo = row[3]; // Colonna D

                if (desc && prezzo && !isNaN(prezzo)) {
                    // Mappatura semplificata
                    const descLower = desc.toLowerCase();
                    
                    if (descLower.includes('estensione guida')) prezzi.opt_estensione_guida = parseFloat(prezzo);
                    if (descLower.includes('guida tagliata')) prezzi.opt_guida_tagliata = parseFloat(prezzo);
                    if (descLower.includes('tappeti')) prezzi.opt_tappeti = parseFloat(prezzo);
                    if (descLower.includes('guida al mt')) prezzi.metri_guida = parseFloat(prezzo);
                    if (descLower.includes('ogni alzata')) prezzi.alzate = parseFloat(prezzo);
                    // ... aggiungi altri mapping necessari
                }
            }

            return prezzi;
        }
    </script>
</body>
</html>
